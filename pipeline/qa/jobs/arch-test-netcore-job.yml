jobs:
  - job: 'architecture_adherence_netcore'
    displayName: 'Architecture Adherence Automation Test'
    pool:
      name: hosted-dockerized-linux
    
    steps:

      - task: qetza.replacetokens.replacetokens-task.replacetokens@4
        displayName: Replace nugget Tokens
        inputs:
          rootDirectory: 'src'
          targetFiles: |
            **/NuGet.config
            **/Dockerfile
          encoding: 'auto'
          writeBOM: true
          actionOnMissing: 'warn'
          keepToken: false
          tokenPrefix: '#{'
          tokenSuffix: '}#'
          useLegacyPattern: false
          enableTelemetry: true

      - task: DotNetCoreCLI@2
        displayName: Clean
        inputs:
          command: custom
          projects: '**/**/*.csproj'
          custom: clean
          arguments: '--configuration $(BuildConfiguration)'

      - task: DotNetCoreCLI@2
        displayName: Restore
        inputs:
          command: 'restore'
          projects: '**/**/*.csproj'
          feedsToUse: 'select'
          vstsFeed: '1eccc046-a46d-4d01-a61f-22c450d2ce9e'

      - task: DotNetCoreCLI@2
        displayName: Build
        inputs:
          projects: '**/**/*.csproj'
          arguments: '--configuration $(BuildConfiguration) --force'

      - task: DotNetCoreCLI@2
        displayName: 'Architecture Tests'
        inputs:
          command: test
          projects: '**/**/*[Aa]rch*[Tt]est*/*.csproj'
          testRunTitle: 'ArchitectureTest Results'
